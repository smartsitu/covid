{"ast":null,"code":"var _jsxFileName = \"/Users/maclaptop/Documents/GitHub/ashokpandey.com/src/components/deltabargraph.js\";\nimport * as d3 from 'd3';\nimport React, { useEffect, useRef, useState } from 'react';\n\nfunction DeltaBarGraph({\n  timeseries,\n  arrayKey\n}) {\n  const [data, setData] = useState([]);\n  const svgRef = useRef();\n  useEffect(() => {\n    setData(timeseries);\n  }, [timeseries]);\n  useEffect(() => {\n    if (!data.length) return;\n    const svg = d3.select(svgRef.current);\n    const width = +svg.attr('width');\n    const height = +svg.attr('height');\n    const margin = {\n      top: 50,\n      right: 0,\n      bottom: 50,\n      left: 0\n    };\n    const chartRight = width - margin.right;\n    const chartBottom = height - margin.bottom;\n    const barRadius = 5;\n    const formatTime = d3.timeFormat('%e %b');\n    const xScale = d3.scaleBand().domain(data.map(d => formatTime(d.date))).range([margin.left, chartRight]).paddingInner(0.33);\n    const yScale = d3.scaleLinear().domain([0, Math.max(1, d3.max(data, d => d[arrayKey]))]).range([chartBottom, margin.top]); // - barRadius\n\n    const xAxis = d3.axisBottom(xScale).tickSize(0);\n    svg.select('.x-axis').style('transform', `translateY(${chartBottom}px)`).call(xAxis).call(g => g.select('.domain').remove()).selectAll('text').attr('y', 0).attr('dy', '1.5em').style('text-anchor', 'middle');\n    svg.selectAll('.bar').data(data).join('path').attr('class', 'bar').attr('d', d => roundedBar(xScale(formatTime(d.date)), chartBottom, xScale.bandwidth(), chartBottom - yScale(d[arrayKey]), barRadius)).attr('fill', (d, i) => i < data.length - 1 ? '#dc354590' : '#dc3545');\n    svg.selectAll('.delta').data(data).join('text').attr('class', 'delta').attr('text-anchor', 'middle').attr('font-size', '11px').attr('x', d => xScale(formatTime(d.date)) + xScale.bandwidth() / 2).attr('y', d => yScale(d[arrayKey]) - 6).text(d => d[arrayKey]).append('tspan').attr('class', 'percent').attr('x', d => xScale(formatTime(d.date)) + xScale.bandwidth() / 2).attr('dy', '-1.2em').text((d, i) => i && data[i - 1][arrayKey] ? d3.format('+.1%')((data[i][arrayKey] - data[i - 1][arrayKey]) / data[i - 1][arrayKey]) : '');\n  }, [data, arrayKey]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"DeltaBarGraph fadeInUp\",\n    style: {\n      animationDelay: '0.8s'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"svg\", {\n    ref: svgRef,\n    width: \"250\",\n    height: \"250\",\n    viewBox: \"0 0 250 250\",\n    preserveAspectRatio: \"xMidYMid meet\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"g\", {\n    className: \"x-axis\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"g\", {\n    className: \"y-axis\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 9\n    }\n  })));\n}\n\nexport default React.memo(DeltaBarGraph, () => {\n  return true;\n});\n\nfunction roundedBar(x, y, w, h, r, f) {\n  if (!h) return; // Flag for sweep:\n\n  if (f === undefined) f = 1; // x coordinates of top of arcs\n\n  const x0 = x + r;\n  const x1 = x + w - r; // y coordinates of bottom of arcs\n\n  const y0 = y - h + r;\n  const parts = ['M', x, y, 'L', x, y0, 'A', r, r, 0, 0, f, x0, y - h, 'L', x1, y - h, 'A', r, r, 0, 0, f, x + w, y0, 'L', x + w, y, 'Z'];\n  return parts.join(' ');\n}","map":{"version":3,"sources":["/Users/maclaptop/Documents/GitHub/ashokpandey.com/src/components/deltabargraph.js"],"names":["d3","React","useEffect","useRef","useState","DeltaBarGraph","timeseries","arrayKey","data","setData","svgRef","length","svg","select","current","width","attr","height","margin","top","right","bottom","left","chartRight","chartBottom","barRadius","formatTime","timeFormat","xScale","scaleBand","domain","map","d","date","range","paddingInner","yScale","scaleLinear","Math","max","xAxis","axisBottom","tickSize","style","call","g","remove","selectAll","join","roundedBar","bandwidth","i","text","append","format","animationDelay","memo","x","y","w","h","r","f","undefined","x0","x1","y0","parts"],"mappings":";AAAA,OAAO,KAAKA,EAAZ,MAAoB,IAApB;AACA,OAAOC,KAAP,IAAeC,SAAf,EAA0BC,MAA1B,EAAkCC,QAAlC,QAAiD,OAAjD;;AAEA,SAASC,aAAT,CAAuB;AAACC,EAAAA,UAAD;AAAaC,EAAAA;AAAb,CAAvB,EAA+C;AAC7C,QAAM,CAACC,IAAD,EAAOC,OAAP,IAAkBL,QAAQ,CAAC,EAAD,CAAhC;AACA,QAAMM,MAAM,GAAGP,MAAM,EAArB;AAEAD,EAAAA,SAAS,CAAC,MAAM;AACdO,IAAAA,OAAO,CAACH,UAAD,CAAP;AACD,GAFQ,EAEN,CAACA,UAAD,CAFM,CAAT;AAIAJ,EAAAA,SAAS,CAAC,MAAM;AACd,QAAI,CAACM,IAAI,CAACG,MAAV,EAAkB;AAElB,UAAMC,GAAG,GAAGZ,EAAE,CAACa,MAAH,CAAUH,MAAM,CAACI,OAAjB,CAAZ;AACA,UAAMC,KAAK,GAAG,CAACH,GAAG,CAACI,IAAJ,CAAS,OAAT,CAAf;AACA,UAAMC,MAAM,GAAG,CAACL,GAAG,CAACI,IAAJ,CAAS,QAAT,CAAhB;AAEA,UAAME,MAAM,GAAG;AAACC,MAAAA,GAAG,EAAE,EAAN;AAAUC,MAAAA,KAAK,EAAE,CAAjB;AAAoBC,MAAAA,MAAM,EAAE,EAA5B;AAAgCC,MAAAA,IAAI,EAAE;AAAtC,KAAf;AACA,UAAMC,UAAU,GAAGR,KAAK,GAAGG,MAAM,CAACE,KAAlC;AACA,UAAMI,WAAW,GAAGP,MAAM,GAAGC,MAAM,CAACG,MAApC;AACA,UAAMI,SAAS,GAAG,CAAlB;AAEA,UAAMC,UAAU,GAAG1B,EAAE,CAAC2B,UAAH,CAAc,OAAd,CAAnB;AACA,UAAMC,MAAM,GAAG5B,EAAE,CACd6B,SADY,GAEZC,MAFY,CAELtB,IAAI,CAACuB,GAAL,CAAUC,CAAD,IAAON,UAAU,CAACM,CAAC,CAACC,IAAH,CAA1B,CAFK,EAGZC,KAHY,CAGN,CAAChB,MAAM,CAACI,IAAR,EAAcC,UAAd,CAHM,EAIZY,YAJY,CAIC,IAJD,CAAf;AAMA,UAAMC,MAAM,GAAGpC,EAAE,CACdqC,WADY,GAEZP,MAFY,CAEL,CACN,CADM,EAENQ,IAAI,CAACC,GAAL,CACE,CADF,EAEEvC,EAAE,CAACuC,GAAH,CAAO/B,IAAP,EAAcwB,CAAD,IAAOA,CAAC,CAACzB,QAAD,CAArB,CAFF,CAFM,CAFK,EASZ2B,KATY,CASN,CAACV,WAAD,EAAcN,MAAM,CAACC,GAArB,CATM,CAAf,CAnBc,CA4BuB;;AAErC,UAAMqB,KAAK,GAAGxC,EAAE,CAACyC,UAAH,CAAcb,MAAd,EAAsBc,QAAtB,CAA+B,CAA/B,CAAd;AAEA9B,IAAAA,GAAG,CACAC,MADH,CACU,SADV,EAEG8B,KAFH,CAES,WAFT,EAEuB,cAAanB,WAAY,KAFhD,EAGGoB,IAHH,CAGQJ,KAHR,EAIGI,IAJH,CAISC,CAAD,IAAOA,CAAC,CAAChC,MAAF,CAAS,SAAT,EAAoBiC,MAApB,EAJf,EAKGC,SALH,CAKa,MALb,EAMG/B,IANH,CAMQ,GANR,EAMa,CANb,EAOGA,IAPH,CAOQ,IAPR,EAOc,OAPd,EAQG2B,KARH,CAQS,aART,EAQwB,QARxB;AAUA/B,IAAAA,GAAG,CACAmC,SADH,CACa,MADb,EAEGvC,IAFH,CAEQA,IAFR,EAGGwC,IAHH,CAGQ,MAHR,EAIGhC,IAJH,CAIQ,OAJR,EAIiB,KAJjB,EAKGA,IALH,CAKQ,GALR,EAKcgB,CAAD,IACTiB,UAAU,CACRrB,MAAM,CAACF,UAAU,CAACM,CAAC,CAACC,IAAH,CAAX,CADE,EAERT,WAFQ,EAGRI,MAAM,CAACsB,SAAP,EAHQ,EAIR1B,WAAW,GAAGY,MAAM,CAACJ,CAAC,CAACzB,QAAD,CAAF,CAJZ,EAKRkB,SALQ,CANd,EAcGT,IAdH,CAcQ,MAdR,EAcgB,CAACgB,CAAD,EAAImB,CAAJ,KAAWA,CAAC,GAAG3C,IAAI,CAACG,MAAL,GAAc,CAAlB,GAAsB,WAAtB,GAAoC,SAd/D;AAgBAC,IAAAA,GAAG,CACAmC,SADH,CACa,QADb,EAEGvC,IAFH,CAEQA,IAFR,EAGGwC,IAHH,CAGQ,MAHR,EAIGhC,IAJH,CAIQ,OAJR,EAIiB,OAJjB,EAKGA,IALH,CAKQ,aALR,EAKuB,QALvB,EAMGA,IANH,CAMQ,WANR,EAMqB,MANrB,EAOGA,IAPH,CAOQ,GAPR,EAOcgB,CAAD,IAAOJ,MAAM,CAACF,UAAU,CAACM,CAAC,CAACC,IAAH,CAAX,CAAN,GAA6BL,MAAM,CAACsB,SAAP,KAAqB,CAPtE,EAQGlC,IARH,CAQQ,GARR,EAQcgB,CAAD,IAAOI,MAAM,CAACJ,CAAC,CAACzB,QAAD,CAAF,CAAN,GAAsB,CAR1C,EASG6C,IATH,CASSpB,CAAD,IAAOA,CAAC,CAACzB,QAAD,CAThB,EAUG8C,MAVH,CAUU,OAVV,EAWGrC,IAXH,CAWQ,OAXR,EAWiB,SAXjB,EAYGA,IAZH,CAYQ,GAZR,EAYcgB,CAAD,IAAOJ,MAAM,CAACF,UAAU,CAACM,CAAC,CAACC,IAAH,CAAX,CAAN,GAA6BL,MAAM,CAACsB,SAAP,KAAqB,CAZtE,EAaGlC,IAbH,CAaQ,IAbR,EAac,QAbd,EAcGoC,IAdH,CAcQ,CAACpB,CAAD,EAAImB,CAAJ,KACJA,CAAC,IAAI3C,IAAI,CAAC2C,CAAC,GAAG,CAAL,CAAJ,CAAY5C,QAAZ,CAAL,GACIP,EAAE,CAACsD,MAAH,CAAU,MAAV,EACE,CAAC9C,IAAI,CAAC2C,CAAD,CAAJ,CAAQ5C,QAAR,IAAoBC,IAAI,CAAC2C,CAAC,GAAG,CAAL,CAAJ,CAAY5C,QAAZ,CAArB,IACEC,IAAI,CAAC2C,CAAC,GAAG,CAAL,CAAJ,CAAY5C,QAAZ,CAFJ,CADJ,GAKI,EApBR;AAsBD,GAhFQ,EAgFN,CAACC,IAAD,EAAOD,QAAP,CAhFM,CAAT;AAkFA,sBACE;AAAK,IAAA,SAAS,EAAC,wBAAf;AAAwC,IAAA,KAAK,EAAE;AAACgD,MAAAA,cAAc,EAAE;AAAjB,KAA/C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE;AACE,IAAA,GAAG,EAAE7C,MADP;AAEE,IAAA,KAAK,EAAC,KAFR;AAGE,IAAA,MAAM,EAAC,KAHT;AAIE,IAAA,OAAO,EAAC,aAJV;AAKE,IAAA,mBAAmB,EAAC,eALtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAOE;AAAG,IAAA,SAAS,EAAC,QAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAPF,eAQE;AAAG,IAAA,SAAS,EAAC,QAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IARF,CADF,CADF;AAcD;;AAED,eAAeT,KAAK,CAACuD,IAAN,CAAWnD,aAAX,EAA0B,MAAM;AAC7C,SAAO,IAAP;AACD,CAFc,CAAf;;AAIA,SAAS4C,UAAT,CAAoBQ,CAApB,EAAuBC,CAAvB,EAA0BC,CAA1B,EAA6BC,CAA7B,EAAgCC,CAAhC,EAAmCC,CAAnC,EAAsC;AACpC,MAAI,CAACF,CAAL,EAAQ,OAD4B,CAEpC;;AACA,MAAIE,CAAC,KAAKC,SAAV,EAAqBD,CAAC,GAAG,CAAJ,CAHe,CAIpC;;AACA,QAAME,EAAE,GAAGP,CAAC,GAAGI,CAAf;AACA,QAAMI,EAAE,GAAGR,CAAC,GAAGE,CAAJ,GAAQE,CAAnB,CANoC,CAOpC;;AACA,QAAMK,EAAE,GAAGR,CAAC,GAAGE,CAAJ,GAAQC,CAAnB;AAEA,QAAMM,KAAK,GAAG,CACZ,GADY,EAEZV,CAFY,EAGZC,CAHY,EAIZ,GAJY,EAKZD,CALY,EAMZS,EANY,EAOZ,GAPY,EAQZL,CARY,EASZA,CATY,EAUZ,CAVY,EAWZ,CAXY,EAYZC,CAZY,EAaZE,EAbY,EAcZN,CAAC,GAAGE,CAdQ,EAeZ,GAfY,EAgBZK,EAhBY,EAiBZP,CAAC,GAAGE,CAjBQ,EAkBZ,GAlBY,EAmBZC,CAnBY,EAoBZA,CApBY,EAqBZ,CArBY,EAsBZ,CAtBY,EAuBZC,CAvBY,EAwBZL,CAAC,GAAGE,CAxBQ,EAyBZO,EAzBY,EA0BZ,GA1BY,EA2BZT,CAAC,GAAGE,CA3BQ,EA4BZD,CA5BY,EA6BZ,GA7BY,CAAd;AA+BA,SAAOS,KAAK,CAACnB,IAAN,CAAW,GAAX,CAAP;AACD","sourcesContent":["import * as d3 from 'd3';\nimport React, {useEffect, useRef, useState} from 'react';\n\nfunction DeltaBarGraph({timeseries, arrayKey}) {\n  const [data, setData] = useState([]);\n  const svgRef = useRef();\n\n  useEffect(() => {\n    setData(timeseries);\n  }, [timeseries]);\n\n  useEffect(() => {\n    if (!data.length) return;\n\n    const svg = d3.select(svgRef.current);\n    const width = +svg.attr('width');\n    const height = +svg.attr('height');\n\n    const margin = {top: 50, right: 0, bottom: 50, left: 0};\n    const chartRight = width - margin.right;\n    const chartBottom = height - margin.bottom;\n    const barRadius = 5;\n\n    const formatTime = d3.timeFormat('%e %b');\n    const xScale = d3\n      .scaleBand()\n      .domain(data.map((d) => formatTime(d.date)))\n      .range([margin.left, chartRight])\n      .paddingInner(0.33);\n\n    const yScale = d3\n      .scaleLinear()\n      .domain([\n        0,\n        Math.max(\n          1,\n          d3.max(data, (d) => d[arrayKey])\n        ),\n      ])\n      .range([chartBottom, margin.top]); // - barRadius\n\n    const xAxis = d3.axisBottom(xScale).tickSize(0);\n\n    svg\n      .select('.x-axis')\n      .style('transform', `translateY(${chartBottom}px)`)\n      .call(xAxis)\n      .call((g) => g.select('.domain').remove())\n      .selectAll('text')\n      .attr('y', 0)\n      .attr('dy', '1.5em')\n      .style('text-anchor', 'middle');\n\n    svg\n      .selectAll('.bar')\n      .data(data)\n      .join('path')\n      .attr('class', 'bar')\n      .attr('d', (d) =>\n        roundedBar(\n          xScale(formatTime(d.date)),\n          chartBottom,\n          xScale.bandwidth(),\n          chartBottom - yScale(d[arrayKey]),\n          barRadius\n        )\n      )\n      .attr('fill', (d, i) => (i < data.length - 1 ? '#dc354590' : '#dc3545'));\n\n    svg\n      .selectAll('.delta')\n      .data(data)\n      .join('text')\n      .attr('class', 'delta')\n      .attr('text-anchor', 'middle')\n      .attr('font-size', '11px')\n      .attr('x', (d) => xScale(formatTime(d.date)) + xScale.bandwidth() / 2)\n      .attr('y', (d) => yScale(d[arrayKey]) - 6)\n      .text((d) => d[arrayKey])\n      .append('tspan')\n      .attr('class', 'percent')\n      .attr('x', (d) => xScale(formatTime(d.date)) + xScale.bandwidth() / 2)\n      .attr('dy', '-1.2em')\n      .text((d, i) =>\n        i && data[i - 1][arrayKey]\n          ? d3.format('+.1%')(\n              (data[i][arrayKey] - data[i - 1][arrayKey]) /\n                data[i - 1][arrayKey]\n            )\n          : ''\n      );\n  }, [data, arrayKey]);\n\n  return (\n    <div className=\"DeltaBarGraph fadeInUp\" style={{animationDelay: '0.8s'}}>\n      <svg\n        ref={svgRef}\n        width=\"250\"\n        height=\"250\"\n        viewBox=\"0 0 250 250\"\n        preserveAspectRatio=\"xMidYMid meet\"\n      >\n        <g className=\"x-axis\" />\n        <g className=\"y-axis\" />\n      </svg>\n    </div>\n  );\n}\n\nexport default React.memo(DeltaBarGraph, () => {\n  return true;\n});\n\nfunction roundedBar(x, y, w, h, r, f) {\n  if (!h) return;\n  // Flag for sweep:\n  if (f === undefined) f = 1;\n  // x coordinates of top of arcs\n  const x0 = x + r;\n  const x1 = x + w - r;\n  // y coordinates of bottom of arcs\n  const y0 = y - h + r;\n\n  const parts = [\n    'M',\n    x,\n    y,\n    'L',\n    x,\n    y0,\n    'A',\n    r,\n    r,\n    0,\n    0,\n    f,\n    x0,\n    y - h,\n    'L',\n    x1,\n    y - h,\n    'A',\n    r,\n    r,\n    0,\n    0,\n    f,\n    x + w,\n    y0,\n    'L',\n    x + w,\n    y,\n    'Z',\n  ];\n  return parts.join(' ');\n}\n"]},"metadata":{},"sourceType":"module"}